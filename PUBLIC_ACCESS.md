# 外部ネットワークからのアクセス設定

## 概要
別のネットワーク（インターネット経由）から勤怠管理システムにアクセスする方法

## 方法1: ngrok を使用（推奨・簡単）

### ngrokとは
ngrokは、ローカルサーバーを安全にインターネットに公開するツールです。

### セットアップ手順

1. **ngrokをダウンロード**
   - https://ngrok.com/download にアクセス
   - Windows版をダウンロード
   - ZIPファイルを解凍

2. **ngrokアカウント作成（無料）**
   - https://dashboard.ngrok.com/signup で登録
   - 認証トークンを取得

3. **ngrok設定**
   ```cmd
   ngrok config add-authtoken YOUR_AUTH_TOKEN
   ```

4. **統合サーバーを起動**
   ```cmd
   python run.py
   ```

5. **別のターミナルでngrokを起動**
   ```cmd
   ngrok http 8001
   ```

6. **生成されたURLでアクセス**
   ```
   Forwarding: https://xxxx-xxxx-xxxx.ngrok.io -> http://localhost:8001
   ```
   この `https://xxxx-xxxx-xxxx.ngrok.io` がパブリックURLです。

### バッチファイルで自動化

`start-public.bat` を作成：
```batch
@echo off
echo 統合サーバーとngrokを起動中...
start cmd /k "python run.py"
timeout /t 3
start cmd /k "ngrok http 8001"
echo.
echo ngrokのURLを確認してアクセスしてください
pause
```

## 方法2: ポートフォワーディング（中級者向け）

### ルーター設定
1. ルーター管理画面にアクセス（通常 192.168.1.1 または 192.168.0.1）
2. ポートフォワーディング設定を開く
3. 以下を設定：
   - 外部ポート: 8001
   - 内部IP: あなたのPCのIP（例: 192.168.1.100）
   - 内部ポート: 8001
   - プロトコル: TCP

### グローバルIPでアクセス
- あなたのグローバルIP確認: https://whatismyipaddress.com/
- アクセス: `http://[グローバルIP]:8001`

### 注意事項
- ISPによってはポート開放が制限されている場合があります
- 動的IPの場合、IPアドレスが変わる可能性があります
- セキュリティリスクが高いため、本番環境では非推奨

## 方法3: クラウドサービスを使用（本番向け）

### 選択肢
1. **Vercel** - 簡単、無料枠あり
2. **Heroku** - 柔軟、無料枠あり（制限付き）
3. **AWS EC2** - 高機能、1年間無料枠
4. **Google Cloud Run** - サーバーレス、無料枠あり

既にVercel用の設定は完了しているので、`vercel`コマンドでデプロイ可能です。

## セキュリティ上の注意事項

### 必須対策
1. **強力なパスワード使用**
   - デフォルトの testuser/testpass は変更必須
   - 最低12文字以上の複雑なパスワード

2. **HTTPS使用**
   - ngrokは自動的にHTTPS提供
   - ポートフォワーディングの場合は証明書設定が必要

3. **アクセス制限**
   - 必要なユーザーのみにURLを共有
   - 使用しない時は公開を停止

4. **ログ監視**
   - 不審なアクセスがないか定期的に確認
   - ログファイルの保存

### 本番環境での追加対策
- ファイアウォール設定
- Rate limiting実装
- 2要素認証の追加
- VPN経由のアクセスに限定
- セッションタイムアウト設定
- SQLインジェクション対策（既に実装済み）

## トラブルシューティング

### ngrokが動作しない
- ファイアウォールでngrokを許可
- プロキシ設定を確認
- 無料版は同時接続数に制限あり

### 接続が遅い
- ngrok無料版は帯域制限あり
- 有料版にアップグレードを検討

### セッションが切れる
- ngrok無料版は8時間でセッション終了
- 再起動が必要

## 推奨構成

### 開発・テスト環境
- **ngrok** - 簡単、安全、一時的な共有に最適

### 小規模本番環境
- **Vercel** または **Heroku** - 管理が簡単、自動HTTPS

### 大規模本番環境
- **AWS/GCP/Azure** - スケーラブル、高可用性

## まとめ

最も簡単な方法は **ngrok** です：
1. ngrokをダウンロード
2. `python run.py` でサーバー起動
3. `ngrok http 8001` でトンネル作成
4. 生成されたURLを共有

これで世界中どこからでもアクセス可能になります！